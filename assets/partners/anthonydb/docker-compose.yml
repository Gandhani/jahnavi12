## Docker Compose file for running e2e tests
version: "3"

services:
  db:
    image: mcr.microsoft.com/mssql/server:2019-latest
    environment:
      ACCEPT_EULA: Y
      SA_PASSWORD: BK72nEAoI72CSWmP
    ports:
      - 1433:1433
  integration_test:
    build:
      context: .
      dockerfile: Dockerfile
    command: pytest -vvv test_ge.py
    environment:
      DB_URL: ${DB_URL}
    depends_on:
      - provision
  provision:
    build:
      context: .
      dockerfile: provision.Dockerfile
    command: cat provision.mssql | /opt/mssql-tools/bin/sqlcmd -S db -U sa -P "$DB_PASS" -i /dev/stdin
    depends_on:
      - db
